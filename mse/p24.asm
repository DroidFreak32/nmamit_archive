; Scan an 8 x 3 keypad for key closure and simulate ADD and SUBTRACT operations as in a calculator.
PA EQU 0DD00H
PB EQU PA+1
PC EQU PB+1
PCW EQU PC+1
CW EQU 90H
ASSUME CS:CODE,DS:DATA
DATA SEGMENT
ROW DB ?
COL DB ?
VAL DB ?
DATA ENDS
CODE SEGMENT
START:
MOV AX,DATA
MOV DS,AX
MOV AL,CW
MOV DX,PCW
OUT DX,AL
UP: MOV AL,01
MOV DX,PC
OUT DX,AL
MOV DX,PA
IN AL,DX
CMP AL,0
JNE FIRSTROW
MOV AL,02
MOV DX,PC
OUT DX,AL
MOV DX,PA
IN AL,DX
CMP AL,0
JNE SECONDROW
MOV AL,04
MOV DX,PC
OUT DX,AL
MOV DX,PA
IN AL,DX
CMP AL,0
JNE THIRDROW
JMP UP
FIRSTROW: CALL DELAY
MOV BL,1 ;ROW
MOV BH,1 ;COL
MOV CL,0 ;VALUE
UP1:
ROR AL,1
JC DISPLAY
INC BH
INC CL
JMP UP1
SECONDROW:
CALL DELAY
MOV BL,2
MOV BH,1
MOV CL,8
UP2:
ROR AL,1
JC DISPLAY
INC BH
INC CL
JMP UP2
THIRDROW:
CALL DELAY
MOV BL,3
MOV BH,1
MOV CL,10H
UP3:
ROR AL,1
JC DISPLAY
INC BH
INC CL
JMP UP3
DISPLAY:
MOV ROW,BL
MOV COL,BH
MOV VAL,CL
MOV BL,ROW
CALL DISP8B
MOV BL,COL
CALL DISP8B
MOV BL,VAL
CALL DISP8B
INT 21H
D1:
D2:
DISP8B PROC
PUSH AX
MOV CL,4
MOV AL,BL
AND AL,0F0H
CMP AL,09H
JBE D1
ADD AL,07H
ADD AL,30H
MOV DL,AL
MOV AH,02H
INT 21H
MOV AL,BL
AND AL,0FH
CMP AL,09H
JBE D2
ADD AL,7
ADD AL,30H
MOV DL,AL
MOV AH,02H
INT 21H
POP AX
RET
DISP8B ENDP
THERE:
HERE:
DELAY PROC
PUSH CX
PUSH BX
MOV CX,0FFFFH
MOV BX,0FFFFH
DEC BX
JNZ HERE
DEC CX
JNZ THERE
POP BX
POP CX
RET
DELAY ENDP
CODE ENDS
END START
